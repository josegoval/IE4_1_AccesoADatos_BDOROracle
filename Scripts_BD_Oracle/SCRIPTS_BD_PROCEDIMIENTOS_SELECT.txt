 ----------------------------------------
| CREACIÃ“N DE FUNCIONES Y PROCEDIMIENTOS |
 ----------------------------------------

	 --------
	| CREATE |
	 --------

	-- ALUMNO --

CREATE OR REPLACE PROCEDURE GET_ALUMNO (DNI_IN IN VARCHAR2, P_CURSOR OUT SYS_REFCURSOR) 
IS
	SUS_TELEFONOS TYPE_TELEFONOS;
	TELF1 VARCHAR2(15);
	TELF2 VARCHAR2(15);
BEGIN
	SELECT A.TELEFONOS INTO SUS_TELEFONOS FROM TALUMNOS A WHERE A.DNI = DNI_IN;
    
    FOR i IN SUS_TELEFONOS.FIRST..SUS_TELEFONOS.LAST LOOP
        IF(I = 0)
			THEN TELF1 := SUS_TELEFONOS(i);
		ELSE
			TELF2 := SUS_TELEFONOS(i);
		END IF;
    END LOOP;

	OPEN P_CURSOR FOR SELECT DNI, NOMBRE, A.DIRECCION.DIRECCION, A.DIRECCION.POBLACION, A.DIRECCION.CODPOSTAL, A.DIRECCION.PROVINCIA,
        TELF1, TELF2, A.FECHA_NAC, A.CURSO.ID_CURSO, A.CURSO.DESCRIPCION, A.CURSO.NIVEL, A.CURSO.TURNO FROM TALUMNOS A WHERE A.DNI = DNI_IN;
END;


CREATE OR REPLACE PROCEDURE GET_NOTAS_ALUMNO (DNI_ALUMNO_IN IN VARCHAR2, P_CURSOR OUT SYS_REFCURSOR)
IS
BEGIN
	OPEN P_CURSOR FOR SELECT N.ASIGNATURA.COD_ASIG, N.ASIGNATURA.NOMBRE, N.ASIGNATURA.TIPO,
   		N.NOTA1EV, N.NOTA2EV, N.NOTA3EV, N.NOTAFJUN, N.NOTASEPT FROM TALUMNOS A, TABLE(A.TNOTAS) N WHERE A.DNI = DNI_ALUMNO_IN;
END;
	

	-- ASIGNATURA --

CREATE OR REPLACE PROCEDURE GET_ASIGNATURA (COD_ASIG_IN IN NUMBER, P_CURSOR OUT SYS_REFCURSOR) 
IS
BEGIN
	OPEN P_CURSOR FOR SELECT * FROM TASIGNATURAS A WHERE A.COD_ASIG = COD_ASIG_IN;
END;


	-- CURSO --

CREATE OR REPLACE PROCEDURE GET_CURSO (ID_CURSO_IN NUMBER, P_CURSOR OUT SYS_REFCURSOR) 
IS
BEGIN
	OPEN P_CURSOR FOR SELECT * FROM TCURSOS C WHERE C.ID_CURSO = ID_CURSO_IN;
END;