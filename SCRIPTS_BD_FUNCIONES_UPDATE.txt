 ----------------------------------------
| CREACIÃ“N DE FUNCIONES Y PROCEDIMIENTOS |
 ----------------------------------------

	 --------
	| UPDATE |
	 --------

	-- ALUMNO --

CREATE OR REPLACE FUNCTION UPDATE_ALUMNO (
	DNI_IN IN VARCHAR2, 
	NOMBRE_IN IN VARCHAR2, 
	DIRECCION_IN IN VARCHAR2,
	POBLACION_IN IN VARCHAR2,
	CODPOSTAL_IN IN NUMBER,
	PROVINCIA_IN IN VARCHAR,
	TELEFONO1_IN IN VARCHAR2,
	TELEFONO2_IN IN VARCHAR2,
	FECHA_NAC_IN IN DATE,
	ID_CURSO_IN IN NUMBER
	) RETURN NUMBER
IS
   	REFERENCIA_CURSO REF TIPO_CURSO;
BEGIN
    	SELECT REF(C) INTO REFERENCIA_CURSO FROM TCURSOS C WHERE C.ID_CURSO = ID_CURSO_IN;

	UPDATE TALUMNOS A
		SET A.DNI = DNI_IN,
		A.NOMBRE = NOMBRE_IN,
		A.DIRECCION.DIRECCION = DIRECCION_IN,
		A.DIRECCION.POBLACION = POBLACION_IN,
		A.DIRECCION.CODPOSTAL = CODPOSTAL_IN,
		A.DIRECCION.PROVINCIA = PROVINCIA_IN,
		TELEFONOS = TYPE_TELEFONOS(TELEFONO1_IN, TELEFONO2_IN),
		FECHA_NAC = FECHA_NAC_IN,
		CURSO = REFERENCIA_CURSO
			WHERE A.DNI = DNI_IN;
	RETURN 1;
EXCEPTION
	WHEN OTHERS THEN
		RETURN 0;
END;


CREATE OR REPLACE FUNCTION UPDATE_NOTAS (
	DNI_ALUMNO_IN IN VARCHAR2, 
	COD_ASIG_IN IN NUMBER, 
	NOTA1EV_IN IN NUMBER,
	NOTA2EV_IN IN NUMBER,
	NOTA3EV_IN IN NUMBER,
	NOTAFJUN_IN IN NUMBER,
	NOTASEPT_IN IN NUMBER
	)
	RETURN NUMBER
IS
BEGIN
	UPDATE TABLE(SELECT A.TNOTAS FROM TALUMNOS A WHERE A.DNI = DNI_ALUMNO_IN) N
		SET N.NOTA1EV = NOTA1EV_IN,
		N.NOTA2EV = NOTA2EV_IN,
		N.NOTA3EV = NOTA3EV_IN,
		N.NOTAFJUN = NOTAFJUN_IN,
		N.NOTASEPT = NOTASEPT_IN
			WHERE N.ASIGNATURA.COD_ASIG = COD_ASIG_IN;
	RETURN 1;
EXCEPTION
	WHEN OTHERS THEN
		RETURN 0;		
END;
	
	-- ASIGNATURA --

CREATE OR REPLACE FUNCTION UPDATE_ASIGNATURA (
	COD_ASIG_IN IN NUMBER,
	NOMBRE_IN IN VARCHAR2,
	TIPO_IN IN VARCHAR2
	) RETURN NUMBER
IS
	OBJETO_ASIGNATURA TIPO_ASIGNATURA;
BEGIN
	OBJETO_ASIGNATURA := TIPO_ASIGNATURA(COD_ASIG_IN, NOMBRE_IN, TIPO_IN);
	
	IF OBJETO_ASIGNATURA.VALIDAR_TIPO = 1
		THEN UPDATE TASIGNATURAS A
		SET A.NOMBRE = OBJETO_ASIGNATURA.NOMBRE,
		A.TIPO = OBJETO_ASIGNATURA.TIPO
			WHERE A.COD_ASIG = OBJETO_ASIGNATURA.COD_ASIG;
		RETURN 1;
	ELSE
		RETURN -1;
	END IF;
EXCEPTION
	WHEN OTHERS THEN
		RETURN 0;	
END;


	-- CURSO --

CREATE OR REPLACE FUNCTION UPDATE_CURSO (
	ID_CURSO_IN NUMBER,
	DESCRIPCION_IN VARCHAR2,
	NIVEL_IN VARCHAR2,
	TURNO_IN CHAR
	) RETURN NUMBER
IS
	OBJETO_CURSO TIPO_CURSO;
BEGIN
	OBJETO_CURSO := TIPO_CURSO(ID_CURSO_IN, DESCRIPCION_IN, NIVEL_IN, TURNO_IN);
	
	IF OBJETO_CURSO.VALIDAR_TURNO = 1
		THEN UPDATE TCURSOS C SET 
			C.DESCRIPCION = OBJETO_CURSO.DESCRIPCION,
			C.NIVEL = OBJETO_CURSO.NIVEL,
			C.TURNO = OBJETO_CURSO.TURNO
				WHERE C.ID_CURSO = OBJETO_CURSO.ID_CURSO;
		RETURN 1;
	ELSE
		RETURN -1;
	END IF;
EXCEPTION
	WHEN OTHERS THEN
		RETURN 0;	
END;