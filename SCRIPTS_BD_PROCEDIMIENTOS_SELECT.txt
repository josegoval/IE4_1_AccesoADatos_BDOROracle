 ----------------------------------------
| CREACIÃ“N DE FUNCIONES Y PROCEDIMIENTOS |
 ----------------------------------------

	 --------
	| CREATE |
	 --------

	-- ALUMNO --

CREATE OR REPLACE PROCEDURE GET_ALUMNO (DNI_IN IN VARCHAR2, P_CURSOR OUT SYS_REFCURSOR) 
IS
	SUS_TELEFONOS TYPE_TELEFONOS;
	TELF1 VARCHAR2(15);
	TELF2 VARCHAR2(15);
BEGIN
	SELECT A.TELEFONOS INTO SUS_TELEFONOS FROM TALUMNOS A WHERE A.DNI = DNI_IN;
    
    FOR i IN SUS_TELEFONOS.FIRST..SUS_TELEFONOS.LAST LOOP
        IF(I = 0)
			THEN TELF1 := SUS_TELEFONOS(i);
		ELSE
			TELF2 := SUS_TELEFONOS(i);
		END IF;
    END LOOP;

	OPEN P_CURSOR FOR SELECT DNI, NOMBRE, A.DIRECCION.DIRECCION, A.DIRECCION.POBLACION, A.DIRECCION.CODPOSTAL, A.DIRECCION.PROVINCIA,
        TELF1, TELF2, A.FECHA_NAC, A.CURSO.ID_CURSO, A.CURSO.DESCRIPCION, A.CURSO.NIVEL, A.CURSO.TURNO FROM TALUMNOS A WHERE A.DNI = DNI_IN;
END;



GET_NOTAS


CREATE OR REPLACE FUNCTION MATRICULAR_ASIGNATURA (DNI_ALUMNO_IN IN VARCHAR2, COD_ASIG_IN IN NUMBER)
	RETURN NUMBER
IS
	REFERENCIA_ASIGNATURA REF TIPO_ASIGNATURA;
	COD_ASIG_BUSCADA NUMBER;
BEGIN
	SELECT REF(A) INTO REFERENCIA_ASIGNATURA FROM TASIGNATURAS A WHERE A.COD_ASIG = COD_ASIG_IN;
	
	IF REFERENCIA_ASIGNATURA IS NOT NULL THEN
		SELECT N.ASIGNATURA.COD_ASIG INTO COD_ASIG_BUSCADA FROM THE 
			(SELECT AL.TNOTAS FROM TALUMNOS AL WHERE AL.DNI = DNI_ALUMNO_IN)N
			WHERE N.ASIGNATURA.COD_ASIG = COD_ASIG_IN;
	END IF;
	RETURN 0;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
		INSERT INTO TABLE (SELECT TNOTAS FROM TALUMNOS WHERE DNI = DNI_ALUMNO_IN) VALUES (
			REFERENCIA_ASIGNATURA, -1, -1, -1, -1, -1);
		RETURN 1;
	WHEN OTHERS THEN
		RETURN 0;		
END;
	
	-- ASIGNATURA --

CREATE OR REPLACE FUNCTION CREATE_ASIGNATURA (
	COD_ASIG_IN IN NUMBER,
	NOMBRE_IN IN VARCHAR2,
	TIPO_IN IN VARCHAR2
	) RETURN NUMBER
IS
	OBJETO_ASIGNATURA TIPO_ASIGNATURA;
BEGIN
	OBJETO_ASIGNATURA := TIPO_ASIGNATURA(COD_ASIG_IN, NOMBRE_IN, TIPO_IN);
	
	IF OBJETO_ASIGNATURA.VALIDAR_TIPO = 1
		THEN INSERT INTO TASIGNATURAS VALUES (OBJETO_ASIGNATURA.COD_ASIG, OBJETO_ASIGNATURA.NOMBRE, OBJETO_ASIGNATURA.TIPO);
		RETURN 1;
	ELSE
		RETURN -1;
	END IF;
EXCEPTION
	WHEN OTHERS THEN
		RETURN 0;	
END;


	-- CURSO --

CREATE OR REPLACE FUNCTION CREATE_CURSO (
	ID_CURSO_IN NUMBER,
	DESCRIPCION_IN VARCHAR2,
	NIVEL_IN VARCHAR2,
	TURNO_IN CHAR
	) RETURN NUMBER
IS
	OBJETO_CURSO TIPO_CURSO;
BEGIN
	OBJETO_CURSO := TIPO_CURSO(ID_CURSO_IN, DESCRIPCION_IN, NIVEL_IN, TURNO_IN);
	
	IF OBJETO_CURSO.VALIDAR_TURNO = 1
		THEN INSERT INTO TCURSOS VALUES (OBJETO_CURSO.ID_CURSO, OBJETO_CURSO.DESCRIPCION, OBJETO_CURSO.NIVEL, OBJETO_CURSO.TURNO);
		RETURN 1;
	ELSE
		RETURN -1;
	END IF;
EXCEPTION
	WHEN OTHERS THEN
		RETURN 0;	
END;